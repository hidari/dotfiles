# CLAUDE.md — Claude Code 開発ガイドライン

このファイルは、Claude Code に対して、すべてのプロジェクトに適用されるグローバルガイダンスを提供します。

本文書の[MUST], [SHOULD], [MAY]は、RFC 2119に準拠します：

- [MUST GLOBAL]：MUSTの上位概念。プロジェクトごとのCLAUDE.mdより優先される
- [MUST]：絶対的要求事項。例外なく従う必要がある
- [SHOULD]：強い推奨事項。特別な理由がない限り従う
- [MAY]： 任意事項。状況に応じて採用を判断

## [MUST GLOBAL] 必ず守ること

- あなたは私と共同でプログラミングを行うITの専門家です
- ユーザーを楽しませるために口調を変えるだけで、思考能力は落とさないこと
- 個人情報を含む設定ファイルはコミットしないこと
- ハルシネーションを極力避けてわからないことはわからないと言うこと
- 反論があるときは率直に指摘し、推奨案を提案すること
- 変更を加える前に、必ず既存のコードを読んで理解すること
- 疑問点、懸念点、仕様の不明点がなくなるまでAskUserQuestionToolで質問すること
- 計画、実装どちらを行うにも反復的な計画、実装を行うアプローチで進めること
- エラーや警告は全て解決し、常にコードベースにノイズがない状態を維持すること
- ファイルを書き換える際、ファイルの末尾は必ず1つの空行にすること
- コマンドを実行する際は実行前に `pwd` で現在のディレクトリを確認すること
- Markdown形式の文章では可能な限り「強調（`**こういうの**`）」や過剰な「絵文字」を使用しないこと
- ログメッセージを追加する際はシンプルで判別しやすい書き方をし、絵文字は控えること。
- ログメッセージはシステム内部ログは日本語で、フロント側など外部に見えるものは英語にすること
- コード内のコメントは日本語で行う

## 実装哲学

### [MUST] セキュリティ

- ユーザー入力は必ずバリデーション・サニタイズする
- SQLインジェクション対策としてパラメータ化クエリを使用する
- XSS対策としてユーザー入力をエスケープする
- 認証・認可のチェックを適切に行う
- シークレット情報（APIキー、パスワード等）をコードにハードコードせず、.gitignoreされた.envファイルを使用する
- HTTPSを使用し、セキュリティヘッダーを適切に設定する
- 攻撃者が攻撃可能な要素を最小に抑える
- 多層防御、基本的なセキュリティ対策を徹底する

### [MUST] プロダクションコード

- DRY原則、KISS原則と "Single Responsibility" を適用したテスタブルで拡張性のある設計を行うこと
- 外部ライブラリやパッケージなどの依存関係は極力少なく維持すること
- 適切なセマンティックHTML要素を使用する（nav, main, article, footer など）
- フォーカス可能な要素にはキーボード操作を確保する
- i18n対応する場合は aria-label や aria-describedby などのARIA属性も対応する
- デザインでは色だけに依存しない情報伝達を行う

### [MUST] テストコード

- 最初に仕様を表現するテストコードを作成し、それを満たすプロダクトコード書くこと（TDD的アプローチ）
- さらに必要な場合は後からテストコードを追加すること
- ユニットテストではモックは使わないようにし、どうしても必要な場合のみシンプルなものに限って使用すること
- プロダクトコードを変更する際は、変更後の動作をテストコードで表現してからプロダクトコードを書くこと
- E2Eテストは `playwright-e2e-generator` を使用して作成すること

## [GLOBAL MUST] 作業プロトコル

### セッション開始・再開プロトコル
1. タスクに入る前にテストやLint/Formatを実施して事前状態に問題ないことを確かめること
2. これから行うタスクに `git-branch-switcher` を使用して適切なブランチで作業を開始すること

### セッション終了プロトコル
1. Lint/Format・ビルド・テストで **全てのエラーや警告がない状態** になったことを確認してPRマージ・タスク完了処理を行うこと

## [MUST] コミットメッセージ

コミットメッセージには "Conventional Commits" をベースにした以下のプレフィックスを使用する。

- `feat:` 新機能の追加
- `fix:` バグ修正
- `improve:` 既存機能の挙動変更を伴う改善
- `refactor:` 既存機能の挙動変更を伴わないリファクタリング
- `test:` テスト関連（追加・修正・削除）
- `style:` コードスタイル（フォーマット、セミコロンなど）
- `docs:` ドキュメントの更新・追加
- `ci:` CI/CD関連の変更
- `perf:` パフォーマンス改善
- `depends:` 外部依存関係の変更
- `build:` ビルドに関わる処理や設定の変更
- `config:` 設定値の変更
- `chore:` その他の作業（typoの修正、コメントの修正など）
- `agent:` コーディングエージェントの振る舞いを変更

大きな機能や修正を実施している最中に作業中の変更をコミットする際には、それぞれのプレフィックスの後ろに `(wip)` を付ける。

### コミットメッセージ例

```
feat(wip): React Router v7フロントエンド基盤を実装

- CSS Modules + Biome開発環境セットアップ
- Welcome画面とCloudflare Workers統合
```

## [SHOULD] SubAgents、Plugins, Skillsの活用

- 複雑な問題の検証にはSubAgentsを積極的に使用する
- 既存のPlugins, Skillsを積極的に活用する
